

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>solt.transforms._transforms &mdash; solt v0.1.3 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../../_static/css/msmb.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html">
          

          
            
            <img src="../../../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                v0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Welcome to soltâ€™s documentation!</a></li>
</ul>
<p class="caption"><span class="caption-text">Modules:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">solt</a></li>
</ul>
<p class="caption"><span class="caption-text">Examples:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Basics_of_solt.html">Basics of <strong>solt</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Helen_faces.html">Using <strong>solt</strong> to augment keypoints (landmarks) data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../DSBowl18_segmentation.html">Using <strong>solt</strong> for instance and semantic segmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Medical_Data_Augmentation_CXR14.html">Augmenting Medical Images: Chest X-ray 14 dataset</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">solt</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>solt.transforms._transforms</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for solt.transforms._transforms</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">cv2</span>

<span class="kn">from</span> <span class="nn">..constants</span> <span class="k">import</span> <span class="n">allowed_paddings</span><span class="p">,</span> <span class="n">allowed_crops</span><span class="p">,</span> \
    <span class="n">dtypes_max</span><span class="p">,</span> <span class="n">allowed_blurs</span><span class="p">,</span> <span class="n">allowed_color_conversions</span><span class="p">,</span> <span class="n">allowed_interpolations</span>
<span class="kn">from</span> <span class="nn">..utils</span> <span class="k">import</span> <span class="n">img_shape_checker</span>
<span class="kn">from</span> <span class="nn">..data</span> <span class="k">import</span> <span class="n">KeyPoints</span><span class="p">,</span> <span class="n">DataContainer</span>
<span class="kn">from</span> <span class="nn">..base_transforms</span> <span class="k">import</span> <span class="n">BaseTransform</span><span class="p">,</span> <span class="n">MatrixTransform</span><span class="p">,</span> \
    <span class="n">PaddingPropertyHolder</span><span class="p">,</span> <span class="n">DataDependentSamplingTransform</span><span class="p">,</span> <span class="n">InterpolationPropertyHolder</span>

<span class="kn">from</span> <span class="nn">..base_transforms</span> <span class="k">import</span> <span class="n">ImageTransform</span>
<span class="kn">from</span> <span class="nn">..utils</span> <span class="k">import</span> <span class="n">validate_parameter</span><span class="p">,</span> <span class="n">validate_numeric_range_parameter</span>
<span class="kn">from</span> <span class="nn">..core</span> <span class="k">import</span> <span class="n">Stream</span>


<div class="viewcode-block" id="RandomFlip"><a class="viewcode-back" href="../../../transforms.html#solt.transforms.RandomFlip">[docs]</a><span class="k">class</span> <span class="nc">RandomFlip</span><span class="p">(</span><span class="n">BaseTransform</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Random Flipping transform.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    p : float</span>
<span class="sd">        Probability of flip</span>
<span class="sd">    axis : int</span>
<span class="sd">        Axis of flip. Here, 1 stands for horizontal flipping, 0 stands for the vertical one. -1 stands for</span>
<span class="sd">        both axes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">data_indices</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">RandomFlip</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">data_indices</span><span class="o">=</span><span class="n">data_indices</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">axis</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__axis</span> <span class="o">=</span> <span class="n">axis</span>

    <span class="k">def</span> <span class="nf">sample_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@img_shape_checker</span>
    <span class="k">def</span> <span class="nf">_apply_img</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__axis</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">img</span>

    <span class="k">def</span> <span class="nf">_apply_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">mask_new</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__axis</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mask_new</span>

    <span class="k">def</span> <span class="nf">_apply_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">labels</span>

    <span class="k">def</span> <span class="nf">_apply_pts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pts</span><span class="p">:</span> <span class="n">KeyPoints</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="c1"># We should guarantee that we do not change the original data.</span>
        <span class="n">pts_data</span> <span class="o">=</span> <span class="n">pts</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__axis</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">pts_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">pts</span><span class="o">.</span><span class="n">H</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">pts_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__axis</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">pts_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">pts</span><span class="o">.</span><span class="n">W</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">pts_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__axis</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">pts_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">pts</span><span class="o">.</span><span class="n">H</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">pts_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">pts_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">pts</span><span class="o">.</span><span class="n">W</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">pts_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">KeyPoints</span><span class="p">(</span><span class="n">pts</span><span class="o">=</span><span class="n">pts_data</span><span class="p">,</span> <span class="n">H</span><span class="o">=</span><span class="n">pts</span><span class="o">.</span><span class="n">H</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="n">pts</span><span class="o">.</span><span class="n">W</span><span class="p">)</span></div>


<div class="viewcode-block" id="RandomRotate"><a class="viewcode-back" href="../../../transforms.html#solt.transforms.RandomRotate">[docs]</a><span class="k">class</span> <span class="nc">RandomRotate</span><span class="p">(</span><span class="n">MatrixTransform</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Random rotation around the center clockwise</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rotation_range : tuple or float or None</span>
<span class="sd">        Range of rotation.</span>
<span class="sd">        If float, then (-rotation_range, rotation_range) will be used for transformation sampling.</span>
<span class="sd">        if None, then rotation_range=(0,0).</span>
<span class="sd">    interpolation : str or tuple or None</span>
<span class="sd">        Interpolation type. Check the allowed interpolation types.</span>
<span class="sd">    padding : str or tuple or None</span>
<span class="sd">        Padding mode. Check the allowed padding modes.</span>
<span class="sd">    p : float</span>
<span class="sd">        Probability of using this transform</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rotation_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;bilinear&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">RandomRotate</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">interpolation</span><span class="o">=</span><span class="n">interpolation</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rotation_range</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
            <span class="n">rotation_range</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">rotation_range</span><span class="p">,</span> <span class="n">rotation_range</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__range</span> <span class="o">=</span> <span class="n">validate_numeric_range_parameter</span><span class="p">(</span><span class="n">rotation_range</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">rotation_range</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__range</span>

    <span class="k">def</span> <span class="nf">sample_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Samples random rotation within specified range and saves it as an object state.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">__range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">rot</span><span class="p">)),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">rot</span><span class="p">)),</span> <span class="mi">0</span><span class="p">,</span>
                     <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">rot</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">rot</span><span class="p">)),</span> <span class="mi">0</span><span class="p">,</span>
                     <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
                      <span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;rot&#39;</span><span class="p">:</span> <span class="n">rot</span><span class="p">,</span> <span class="s1">&#39;transform_matrix&#39;</span><span class="p">:</span> <span class="n">M</span><span class="p">}</span></div>


<div class="viewcode-block" id="RandomRotate90"><a class="viewcode-back" href="../../../transforms.html#solt.transforms.RandomRotate90">[docs]</a><span class="k">class</span> <span class="nc">RandomRotate90</span><span class="p">(</span><span class="n">RandomRotate</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Random rotation around the center by 90 degrees.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    k : int</span>
<span class="sd">        How many times to rotate the data. If positive, indicates the clockwise direction.</span>
<span class="sd">        Zero by default.</span>
<span class="sd">    p : float</span>
<span class="sd">        Probability of using this transform</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">RandomRotate90</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">rotation_range</span><span class="o">=</span><span class="p">(</span><span class="n">k</span> <span class="o">*</span> <span class="mi">90</span><span class="p">,</span> <span class="n">k</span> <span class="o">*</span> <span class="mi">90</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__k</span> <span class="o">=</span> <span class="o">-</span><span class="n">k</span>

    <span class="nd">@img_shape_checker</span>
    <span class="k">def</span> <span class="nf">_apply_img</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__k</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_apply_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__k</span><span class="p">))</span></div>


<div class="viewcode-block" id="RandomShear"><a class="viewcode-back" href="../../../transforms.html#solt.transforms.RandomShear">[docs]</a><span class="k">class</span> <span class="nc">RandomShear</span><span class="p">(</span><span class="n">MatrixTransform</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Random shear around the center.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    range_x : tuple or float</span>
<span class="sd">        Shearing range along X-axis.</span>
<span class="sd">        If float, then (-range_x, range_x) will be used.</span>
<span class="sd">        If None, then range_x=(0, 0)</span>
<span class="sd">    range_y : tuple or float or None</span>
<span class="sd">        Shearing range along Y-axis. If float, then (-range_y, range_y) will be used.</span>
<span class="sd">        If None, then range_y=(0, 0)</span>
<span class="sd">    interpolation : str or tuple or None or tuple or None</span>
<span class="sd">        Interpolation type. Check the allowed interpolation types.</span>
<span class="sd">    padding : str</span>
<span class="sd">        Padding mode. Check the allowed padding modes.</span>
<span class="sd">    p : float</span>
<span class="sd">        Probability of using this transform</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">range_x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">range_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;bilinear&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">RandomShear</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="n">interpolation</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">range_x</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
            <span class="n">range_x</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">range_x</span><span class="p">,</span> <span class="n">range_x</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">range_y</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
            <span class="n">range_y</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">range_y</span><span class="p">,</span> <span class="n">range_y</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__range_x</span> <span class="o">=</span> <span class="n">validate_numeric_range_parameter</span><span class="p">(</span><span class="n">range_x</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__range_y</span> <span class="o">=</span> <span class="n">validate_numeric_range_parameter</span><span class="p">(</span><span class="n">range_y</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">shear_range_x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__range_x</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">shear_range_y</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__range_y</span>

    <span class="k">def</span> <span class="nf">sample_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">shear_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shear_range_x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">shear_range_x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">shear_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shear_range_y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">shear_range_y</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="n">shear_x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                     <span class="n">shear_y</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                     <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;shear_x&#39;</span><span class="p">:</span> <span class="n">shear_x</span><span class="p">,</span> <span class="s1">&#39;shear_y&#39;</span><span class="p">:</span> <span class="n">shear_y</span><span class="p">,</span> <span class="s1">&#39;transform_matrix&#39;</span><span class="p">:</span> <span class="n">M</span><span class="p">}</span></div>


<div class="viewcode-block" id="RandomScale"><a class="viewcode-back" href="../../../transforms.html#solt.transforms.RandomScale">[docs]</a><span class="k">class</span> <span class="nc">RandomScale</span><span class="p">(</span><span class="n">MatrixTransform</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Random scale transform.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    range_x : tuple or float or None</span>
<span class="sd">        Scaling range along X-axis.</span>
<span class="sd">        If float, then (min(1, range_x), max(1, range_x)) will be used.</span>
<span class="sd">        If None, then range_x =(1,1) by default.</span>
<span class="sd">    range_y : tuple or float</span>
<span class="sd">        Scaling range along Y-axis.</span>
<span class="sd">        If float, then (min(1, range_y), max(1, range_y)) will be used.</span>
<span class="sd">        If None, then range_y=(1,1) by default.</span>
<span class="sd">    same: bool</span>
<span class="sd">        Indicates whether to use the same scaling factor for width and height.</span>
<span class="sd">    interpolation : str or tuple or None</span>
<span class="sd">        Interpolation type. Check the allowed interpolation types.</span>
<span class="sd">        one indicates default behavior - bilinear mode.</span>
<span class="sd">    p : float</span>
<span class="sd">        Probability of using this transform</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">range_x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">range_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">same</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;bilinear&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">RandomScale</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">interpolation</span><span class="o">=</span><span class="n">interpolation</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">range_x</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
            <span class="n">range_x</span> <span class="o">=</span> <span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">range_x</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">range_x</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">range_y</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
            <span class="n">range_y</span> <span class="o">=</span> <span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">range_y</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">range_y</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__same</span> <span class="o">=</span> <span class="n">same</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__range_x</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">range_x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">validate_numeric_range_parameter</span><span class="p">(</span><span class="n">range_x</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">min_val</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__range_y</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">range_y</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">validate_numeric_range_parameter</span><span class="p">(</span><span class="n">range_y</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">min_val</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">scale_range_x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__range_x</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">scale_range_y</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__range_y</span>

    <span class="k">def</span> <span class="nf">sample_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_range_x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">scale_x</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scale_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_range_x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_range_x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_range_y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">scale_y</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scale_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_range_y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_range_y</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__same</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__range_x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">scale_x</span> <span class="o">=</span> <span class="n">scale_y</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">scale_y</span> <span class="o">=</span> <span class="n">scale_x</span>

        <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">scale_x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                      <span class="mi">0</span><span class="p">,</span> <span class="n">scale_y</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                      <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;scale_x&#39;</span><span class="p">:</span> <span class="n">scale_x</span><span class="p">,</span> <span class="s1">&#39;scale_y&#39;</span><span class="p">:</span> <span class="n">scale_y</span><span class="p">,</span> <span class="s1">&#39;transform_matrix&#39;</span><span class="p">:</span> <span class="n">M</span><span class="p">}</span></div>


<div class="viewcode-block" id="RandomTranslate"><a class="viewcode-back" href="../../../transforms.html#solt.transforms.RandomTranslate">[docs]</a><span class="k">class</span> <span class="nc">RandomTranslate</span><span class="p">(</span><span class="n">MatrixTransform</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Random Translate transform..</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    range_x: tuple or int or None</span>
<span class="sd">        Translation range along the horizontal axis. If int, then range_x=(-range_x, range_x).</span>
<span class="sd">        If None, then range_x=(0,0).</span>
<span class="sd">    range_y: tuple or int or None</span>
<span class="sd">        Translation range along the vertical axis. If int, then range_y=(-range_y, range_y).</span>
<span class="sd">        If None, then range_y=(0,0).</span>
<span class="sd">    interpolation: str</span>
<span class="sd">        Interpolation type. See allowed_interpolations in constants.</span>
<span class="sd">    padding: str</span>
<span class="sd">        Padding mode. See allowed_paddings  in constants</span>
<span class="sd">    p: probability of applying this transform.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">range_x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">range_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;bilinear&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">RandomTranslate</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">interpolation</span><span class="o">=</span><span class="n">interpolation</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">range_x</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
            <span class="n">range_x</span> <span class="o">=</span> <span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">range_x</span><span class="p">,</span> <span class="o">-</span><span class="n">range_x</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">range_x</span><span class="p">,</span> <span class="o">-</span><span class="n">range_x</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">range_y</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
            <span class="n">range_y</span> <span class="o">=</span> <span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">range_y</span><span class="p">,</span> <span class="o">-</span><span class="n">range_y</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">range_y</span><span class="p">,</span> <span class="o">-</span><span class="n">range_y</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__range_x</span> <span class="o">=</span> <span class="n">validate_numeric_range_parameter</span><span class="p">(</span><span class="n">range_x</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__range_y</span> <span class="o">=</span> <span class="n">validate_numeric_range_parameter</span><span class="p">(</span><span class="n">range_y</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">translate_range_x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__range_x</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">translate_range_y</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__range_y</span>

    <span class="k">def</span> <span class="nf">sample_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">translate_range_x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate_range_x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ty</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">translate_range_y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate_range_y</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">tx</span><span class="p">,</span>
                      <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ty</span><span class="p">,</span>
                      <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;translate_x&#39;</span><span class="p">:</span> <span class="n">tx</span><span class="p">,</span> <span class="s1">&#39;translate_y&#39;</span><span class="p">:</span> <span class="n">ty</span><span class="p">,</span> <span class="s1">&#39;transform_matrix&#39;</span><span class="p">:</span> <span class="n">M</span><span class="p">}</span></div>


<div class="viewcode-block" id="RandomProjection"><a class="viewcode-back" href="../../../transforms.html#solt.transforms.RandomProjection">[docs]</a><span class="k">class</span> <span class="nc">RandomProjection</span><span class="p">(</span><span class="n">MatrixTransform</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Random Projective transform.</span>

<span class="sd">    Takes a set of affine transforms.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    affine_transforms : Stream or None</span>
<span class="sd">        Stream object, which has a parameterized Affine Transform.</span>
<span class="sd">        If None, then a zero degrees rotation matrix is instantiated.</span>
<span class="sd">    v_range : tuple or None</span>
<span class="sd">        Projective parameters range. If None, then v_range = (0, 0)</span>
<span class="sd">    p : float</span>
<span class="sd">        Probability of using this transform.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">affine_transforms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">v_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;bilinear&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">RandomProjection</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">interpolation</span><span class="o">=</span><span class="n">interpolation</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">affine_transforms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">affine_transforms</span> <span class="o">=</span> <span class="n">Stream</span><span class="p">([</span>
                <span class="n">RandomRotate</span><span class="p">(</span><span class="n">rotation_range</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="n">interpolation</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="p">])</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">affine_transforms</span><span class="p">,</span> <span class="n">Stream</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span>
        <span class="k">for</span> <span class="n">trf</span> <span class="ow">in</span> <span class="n">affine_transforms</span><span class="o">.</span><span class="n">transforms</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trf</span><span class="p">,</span> <span class="n">MatrixTransform</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__affine_transforms</span> <span class="o">=</span> <span class="n">affine_transforms</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__vrange</span> <span class="o">=</span> <span class="n">validate_numeric_range_parameter</span><span class="p">(</span><span class="n">v_range</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>  <span class="c1"># projection components.</span>

    <span class="k">def</span> <span class="nf">sample_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__affine_transforms</span><span class="o">.</span><span class="n">transforms</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">trf</span> <span class="o">=</span> <span class="n">Stream</span><span class="o">.</span><span class="n">optimize_stack</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__affine_transforms</span><span class="o">.</span><span class="n">transforms</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">trf</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">trf</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">trf</span> <span class="o">=</span> <span class="n">trf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__affine_transforms</span><span class="o">.</span><span class="n">transforms</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">trf</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">trf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__affine_transforms</span><span class="o">.</span><span class="n">transforms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">trf</span><span class="o">.</span><span class="n">sample_transform</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">trf</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">M</span> <span class="o">=</span> <span class="n">trf</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s1">&#39;transform_matrix&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">M</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__vrange</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">__vrange</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">M</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__vrange</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">__vrange</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s1">&#39;transform_matrix&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">M</span></div>


<div class="viewcode-block" id="PadTransform"><a class="viewcode-back" href="../../../transforms.html#solt.transforms.PadTransform">[docs]</a><span class="k">class</span> <span class="nc">PadTransform</span><span class="p">(</span><span class="n">DataDependentSamplingTransform</span><span class="p">,</span> <span class="n">PaddingPropertyHolder</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Transformation, which pads the input to a given size</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    pad_to : tuple or int</span>
<span class="sd">        Target size (W_new, Y_new). The padding is computed using teh following equations:</span>

<span class="sd">        left_pad = (pad_to[0] - w) // 2</span>
<span class="sd">        right_pad = (pad_to[0] - w) // 2 + (pad_to[0] - w) % 2</span>
<span class="sd">        top_pad = (pad_to[1] - h) // 2</span>
<span class="sd">        bottom_pad = (pad_to[1] - h) // 2 + (pad_to[1] - h) % 2</span>
<span class="sd">    padding :</span>
<span class="sd">        Padding type.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pad_to</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">DataDependentSamplingTransform</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">PaddingPropertyHolder</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">padding</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pad_to</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pad_to</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pad_to</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">pad_to</span> <span class="o">=</span> <span class="p">(</span><span class="n">pad_to</span><span class="p">,</span> <span class="n">pad_to</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_pad_to</span> <span class="o">=</span> <span class="n">pad_to</span>

    <span class="k">def</span> <span class="nf">sample_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">DataDependentSamplingTransform</span><span class="o">.</span><span class="n">sample_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">sample_transform_from_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">DataContainer</span><span class="p">):</span>
        <span class="n">DataDependentSamplingTransform</span><span class="o">.</span><span class="n">sample_transform_from_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">settings</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="s1">&#39;M&#39;</span> <span class="ow">or</span> <span class="n">t</span> <span class="o">==</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
                <span class="n">h</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">break</span>
            <span class="k">elif</span> <span class="n">t</span> <span class="o">==</span> <span class="s1">&#39;P&#39;</span><span class="p">:</span>
                <span class="n">h</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">H</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">W</span>
                <span class="k">break</span>

        <span class="n">pad_w</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pad_to</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">w</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="n">pad_h</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pad_to</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">h</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>

        <span class="n">pad_h_top</span> <span class="o">=</span> <span class="n">pad_h</span>
        <span class="n">pad_h_bottom</span> <span class="o">=</span> <span class="n">pad_h</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pad_to</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">h</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span>

        <span class="n">pad_w_left</span> <span class="o">=</span> <span class="n">pad_w</span>
        <span class="n">pad_w_right</span> <span class="o">=</span> <span class="n">pad_w</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pad_to</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">w</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span>

        <span class="k">if</span> <span class="n">pad_h</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">pad_h_top</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">pad_h_bottom</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">pad_w</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">pad_w_left</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">pad_w_right</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;pad_h&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">pad_h_top</span><span class="p">,</span> <span class="n">pad_h_bottom</span><span class="p">),</span> <span class="s1">&#39;pad_w&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">pad_w_left</span><span class="p">,</span> <span class="n">pad_w_right</span><span class="p">)}</span>

    <span class="k">def</span> <span class="nf">_apply_img_or_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">pad_h_top</span><span class="p">,</span> <span class="n">pad_h_bottom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s1">&#39;pad_h&#39;</span><span class="p">]</span>
        <span class="n">pad_w_left</span><span class="p">,</span> <span class="n">pad_w_right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s1">&#39;pad_w&#39;</span><span class="p">]</span>
        <span class="n">padding</span> <span class="o">=</span> <span class="n">allowed_paddings</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

        <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;padding&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;strict&#39;</span><span class="p">:</span>
            <span class="n">padding</span> <span class="o">=</span> <span class="n">allowed_paddings</span><span class="p">[</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;padding&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>

        <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">copyMakeBorder</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">pad_h_top</span><span class="p">,</span> <span class="n">pad_h_bottom</span><span class="p">,</span> <span class="n">pad_w_left</span><span class="p">,</span> <span class="n">pad_w_right</span><span class="p">,</span> <span class="n">padding</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="nd">@img_shape_checker</span>
    <span class="k">def</span> <span class="nf">_apply_img</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_img_or_mask</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">settings</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_apply_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_img_or_mask</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">settings</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_apply_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">labels</span>

    <span class="k">def</span> <span class="nf">_apply_pts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pts</span><span class="p">:</span> <span class="n">KeyPoints</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;z&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>
        <span class="n">pts_data</span> <span class="o">=</span> <span class="n">pts</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">pad_h_top</span><span class="p">,</span> <span class="n">pad_h_bottom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s1">&#39;pad_h&#39;</span><span class="p">]</span>
        <span class="n">pad_w_left</span><span class="p">,</span> <span class="n">pad_w_right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s1">&#39;pad_w&#39;</span><span class="p">]</span>

        <span class="n">pts_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">pad_w_left</span>
        <span class="n">pts_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">pad_h_top</span>

        <span class="k">return</span> <span class="n">KeyPoints</span><span class="p">(</span><span class="n">pts_data</span><span class="p">,</span> <span class="n">pad_h_top</span> <span class="o">+</span> <span class="n">pts</span><span class="o">.</span><span class="n">H</span> <span class="o">+</span> <span class="n">pad_h_bottom</span><span class="p">,</span> <span class="n">pad_w_left</span> <span class="o">+</span> <span class="n">pts</span><span class="o">.</span><span class="n">W</span> <span class="o">+</span> <span class="n">pad_w_right</span><span class="p">)</span></div>


<div class="viewcode-block" id="ResizeTransform"><a class="viewcode-back" href="../../../transforms.html#solt.transforms.ResizeTransform">[docs]</a><span class="k">class</span> <span class="nc">ResizeTransform</span><span class="p">(</span><span class="n">BaseTransform</span><span class="p">,</span> <span class="n">InterpolationPropertyHolder</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Transformation, which resizes the input to a given size</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    resize_to : tuple or int</span>
<span class="sd">        Target size (W_new, Y_new).</span>
<span class="sd">    interpolation :</span>
<span class="sd">        Interpolation type.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resize_to</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;bilinear&#39;</span><span class="p">):</span>
        <span class="n">BaseTransform</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">InterpolationPropertyHolder</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="n">interpolation</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">resize_to</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">resize_to</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">resize_to</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">resize_to</span> <span class="o">=</span> <span class="p">(</span><span class="n">resize_to</span><span class="p">,</span> <span class="n">resize_to</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_resize_to</span> <span class="o">=</span> <span class="n">resize_to</span>

    <span class="k">def</span> <span class="nf">sample_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_apply_img_or_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">interp</span> <span class="o">=</span> <span class="n">allowed_interpolations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">interpolation</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;interpolation&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;strict&#39;</span><span class="p">:</span>
            <span class="n">interp</span> <span class="o">=</span> <span class="n">allowed_interpolations</span><span class="p">[</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;interpolation&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>

        <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resize_to</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="n">interp</span><span class="p">)</span>

    <span class="nd">@img_shape_checker</span>
    <span class="k">def</span> <span class="nf">_apply_img</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_img_or_mask</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">settings</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_apply_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_img_or_mask</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">settings</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_apply_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">labels</span>

    <span class="k">def</span> <span class="nf">_apply_pts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pts</span><span class="p">:</span> <span class="n">KeyPoints</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">pts_data</span> <span class="o">=</span> <span class="n">pts</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">resize_x</span><span class="p">,</span> <span class="n">resize_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resize_to</span>

        <span class="n">scale_x</span> <span class="o">=</span> <span class="n">resize_x</span> <span class="o">/</span> <span class="n">pts</span><span class="o">.</span><span class="n">W</span>
        <span class="n">scale_y</span> <span class="o">=</span> <span class="n">resize_y</span> <span class="o">/</span> <span class="n">pts</span><span class="o">.</span><span class="n">H</span>

        <span class="n">pts_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*=</span> <span class="n">scale_x</span>
        <span class="n">pts_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*=</span> <span class="n">scale_y</span>

        <span class="n">pts_data</span> <span class="o">=</span> <span class="n">pts_data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">KeyPoints</span><span class="p">(</span><span class="n">pts_data</span><span class="p">,</span> <span class="n">resize_y</span><span class="p">,</span> <span class="n">resize_x</span><span class="p">)</span></div>


<div class="viewcode-block" id="CropTransform"><a class="viewcode-back" href="../../../transforms.html#solt.transforms.CropTransform">[docs]</a><span class="k">class</span> <span class="nc">CropTransform</span><span class="p">(</span><span class="n">DataDependentSamplingTransform</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Center / Random crop transform.</span>

<span class="sd">    Object performs center or random cropping depending on the parameters.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    crop_size : tuple or int</span>
<span class="sd">        Size of the crop (W_new, H_new). If int, then a square crop will be made.</span>
<span class="sd">    crop_mode : str</span>
<span class="sd">        Crop mode. Can be either &#39;c&#39; - center or &#39;r&#39; - random.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crop_size</span><span class="p">,</span> <span class="n">crop_mode</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CropTransform</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">data_indices</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">crop_size</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">crop_size</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span>
        <span class="k">if</span> <span class="n">crop_mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allowed_crops</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">crop_size</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">crop_size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">crop_size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">crop_size</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">crop_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">crop_size</span><span class="p">,</span> <span class="n">crop_size</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_crop_size</span> <span class="o">=</span> <span class="n">crop_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_crop_mode</span> <span class="o">=</span> <span class="n">crop_mode</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">crop_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_crop_mode</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">crop_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_crop_size</span>

    <span class="k">def</span> <span class="nf">sample_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">def</span> <span class="nf">sample_transform_from_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">DataContainer</span><span class="p">):</span>
        <span class="n">DataDependentSamplingTransform</span><span class="o">.</span><span class="n">sample_transform_from_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">settings</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="s1">&#39;M&#39;</span> <span class="ow">or</span> <span class="n">t</span> <span class="o">==</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
                <span class="n">h</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">break</span>
            <span class="k">elif</span> <span class="n">t</span> <span class="o">==</span> <span class="s1">&#39;P&#39;</span><span class="p">:</span>
                <span class="n">h</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">H</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">W</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">w</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">h</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_mode</span> <span class="o">==</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">w</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">h</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_mode</span> <span class="o">==</span> <span class="s1">&#39;r&#39;</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">w</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_size</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">h</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_size</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">y</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">_crop_img_or_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">img</span><span class="p">[</span><span class="n">y</span><span class="p">:</span><span class="n">y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

    <span class="nd">@img_shape_checker</span>
    <span class="k">def</span> <span class="nf">_apply_img</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_crop_img_or_mask</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_apply_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_crop_img_or_mask</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_apply_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">labels</span>

    <span class="k">def</span> <span class="nf">_apply_pts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pts</span><span class="p">:</span> <span class="n">KeyPoints</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">pts_data</span> <span class="o">=</span> <span class="n">pts</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>

        <span class="n">pts_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="n">x</span>
        <span class="n">pts_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="n">y</span>

        <span class="k">return</span> <span class="n">KeyPoints</span><span class="p">(</span><span class="n">pts_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_size</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>


<div class="viewcode-block" id="ImageAdditiveGaussianNoise"><a class="viewcode-back" href="../../../transforms.html#solt.transforms.ImageAdditiveGaussianNoise">[docs]</a><span class="k">class</span> <span class="nc">ImageAdditiveGaussianNoise</span><span class="p">(</span><span class="n">DataDependentSamplingTransform</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Adds noise to an image. Other types of data than the image are ignored.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    p : float</span>
<span class="sd">        Probability of applying this transfor,</span>
<span class="sd">    gain_range : tuple or float or None</span>
<span class="sd">        Gain of the noise. Final image is created as (1-gain)*img + gain*noise.</span>
<span class="sd">        If float, then gain_range = (0, gain_range). If None, then gain_range=(0, 0).</span>
<span class="sd">    data_indices : tuple or None</span>
<span class="sd">        Indices of the images within the data container to which this transform needs to be applied.</span>
<span class="sd">        Every element within the tuple must be integer numbers.</span>
<span class="sd">        If None, then the transform will be applied to all the images withing the DataContainer.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">gain_range</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">data_indices</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ImageAdditiveGaussianNoise</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">data_indices</span><span class="o">=</span><span class="n">data_indices</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gain_range</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="n">gain_range</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">gain_range</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_gain_range</span> <span class="o">=</span> <span class="n">validate_numeric_range_parameter</span><span class="p">(</span><span class="n">gain_range</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">min_val</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_val</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">sample_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">def</span> <span class="nf">sample_transform_from_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">DataContainer</span><span class="p">):</span>
        <span class="n">DataDependentSamplingTransform</span><span class="o">.</span><span class="n">sample_transform_from_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="n">gain</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_gain_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gain_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">h</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">w</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">c</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">settings</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
                <span class="n">h</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="n">w</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">h</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">c</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>

        <span class="n">noise_img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>

        <span class="n">noise_img</span> <span class="o">-=</span> <span class="n">noise_img</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">noise_img</span> <span class="o">/=</span> <span class="n">noise_img</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">noise_img</span> <span class="o">*=</span> <span class="mi">255</span>
        <span class="n">noise_img</span> <span class="o">=</span> <span class="n">noise_img</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;noise&#39;</span><span class="p">:</span> <span class="n">noise_img</span><span class="p">,</span> <span class="s1">&#39;gain&#39;</span><span class="p">:</span> <span class="n">gain</span><span class="p">}</span>

    <span class="nd">@img_shape_checker</span>
    <span class="k">def</span> <span class="nf">_apply_img</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">addWeighted</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s1">&#39;gain&#39;</span><span class="p">]),</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s1">&#39;noise&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s1">&#39;gain&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_apply_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">mask</span>

    <span class="k">def</span> <span class="nf">_apply_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">labels</span>

    <span class="k">def</span> <span class="nf">_apply_pts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pts</span><span class="p">:</span> <span class="n">KeyPoints</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">pts</span></div>


<div class="viewcode-block" id="ImageSaltAndPepper"><a class="viewcode-back" href="../../../transforms.html#solt.transforms.ImageSaltAndPepper">[docs]</a><span class="k">class</span> <span class="nc">ImageSaltAndPepper</span><span class="p">(</span><span class="n">ImageTransform</span><span class="p">,</span> <span class="n">DataDependentSamplingTransform</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Adds salt and pepper noise to an image. Other types of data than the image are ignored.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    p : float</span>
<span class="sd">        Probability of applying this transform,</span>
<span class="sd">    gain_range : tuple or float or None</span>
<span class="sd">        Gain of the noise. Indicates percentage of indices, which will be changed.</span>
<span class="sd">        If float, then gain_range = (0, gain_range).</span>
<span class="sd">    salt_p : float or tuple or None</span>
<span class="sd">        Percentage of salt. Percentage of pepper is 1-salt_p. If tuple, then salt_p is chosen uniformly from the</span>
<span class="sd">        given range.</span>
<span class="sd">    data_indices : tuple or None</span>
<span class="sd">        Indices of the images within the data container to which this transform needs to be applied.</span>
<span class="sd">        Every element within the tuple must be integer numebers.</span>
<span class="sd">        If None, then the transform will be applied to all the images withing the DataContainer.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">gain_range</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">salt_p</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">data_indices</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ImageSaltAndPepper</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">data_indices</span><span class="o">=</span><span class="n">data_indices</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gain_range</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gain_range</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">salt_p</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">salt_p</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gain_range</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="n">gain_range</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">gain_range</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">salt_p</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="n">salt_p</span> <span class="o">=</span> <span class="p">(</span><span class="n">salt_p</span><span class="p">,</span> <span class="n">salt_p</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_gain_range</span> <span class="o">=</span> <span class="n">validate_numeric_range_parameter</span><span class="p">(</span><span class="n">gain_range</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_salt_p</span> <span class="o">=</span> <span class="n">validate_numeric_range_parameter</span><span class="p">(</span><span class="n">salt_p</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">sample_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">def</span> <span class="nf">sample_transform_from_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">DataContainer</span><span class="p">):</span>
        <span class="n">DataDependentSamplingTransform</span><span class="o">.</span><span class="n">sample_transform_from_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="n">gain</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_gain_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gain_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">salt_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_salt_p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_salt_p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">h</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">w</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">settings</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
                <span class="n">h</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">break</span>

        <span class="n">sp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">gain</span>
        <span class="n">salt</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="o">*</span> <span class="mf">1.</span>
        <span class="n">pepper</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="o">*</span> <span class="mf">1.</span>
        <span class="n">salt_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span> <span class="o">&lt;=</span> <span class="n">salt_p</span><span class="p">)</span>
        <span class="n">pepper_mask</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">salt_mask</span>
        <span class="n">salt</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">salt</span><span class="p">)]</span> <span class="o">*=</span> <span class="n">salt_mask</span>
        <span class="n">pepper</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">pepper</span><span class="p">)]</span> <span class="o">*=</span> <span class="n">pepper_mask</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;salt&#39;</span><span class="p">:</span> <span class="n">salt</span><span class="p">,</span> <span class="s1">&#39;pepper&#39;</span><span class="p">:</span> <span class="n">pepper</span><span class="p">}</span>

    <span class="nd">@img_shape_checker</span>
    <span class="k">def</span> <span class="nf">_apply_img</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">img</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s1">&#39;salt&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="n">dtypes_max</span><span class="p">[</span><span class="n">img</span><span class="o">.</span><span class="n">dtype</span><span class="p">]</span>
        <span class="n">img</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s1">&#39;pepper&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">img</span></div>


<div class="viewcode-block" id="ImageGammaCorrection"><a class="viewcode-back" href="../../../transforms.html#solt.transforms.ImageGammaCorrection">[docs]</a><span class="k">class</span> <span class="nc">ImageGammaCorrection</span><span class="p">(</span><span class="n">ImageTransform</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Transform applies random gamma correction</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    p : float</span>
<span class="sd">        Probability of applying this transform,</span>
<span class="sd">    gamma_range : tuple or float or None</span>
<span class="sd">        Gain of the noise. Indicates percentage of indices, which will be changed.</span>
<span class="sd">        If float, then gain_range = (1-gamma_range, 1+gamma_range).</span>
<span class="sd">    data_indices : tuple or None</span>
<span class="sd">        Indices of the images within the data container to which this transform needs to be applied.</span>
<span class="sd">        Every element within the tuple must be integer numbers.</span>
<span class="sd">        If None, then the transform will be applied to all the images withing the DataContainer.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">gamma_range</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">data_indices</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ImageGammaCorrection</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">data_indices</span><span class="o">=</span><span class="n">data_indices</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gamma_range</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gamma_range</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gamma_range</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="n">gamma_range</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">gamma_range</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">gamma_range</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_gamma_range</span> <span class="o">=</span> <span class="n">validate_numeric_range_parameter</span><span class="p">(</span><span class="n">gamma_range</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">sample_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_gamma_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gamma_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">inv_gamma</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">gamma</span>
        <span class="n">lut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([((</span><span class="n">i</span> <span class="o">/</span> <span class="mf">255.0</span><span class="p">)</span> <span class="o">**</span> <span class="n">inv_gamma</span><span class="p">)</span> <span class="o">*</span> <span class="mi">255</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">256</span><span class="p">)])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;gamma&#39;</span><span class="p">:</span> <span class="n">gamma</span><span class="p">,</span> <span class="s1">&#39;LUT&#39;</span><span class="p">:</span> <span class="n">lut</span><span class="p">}</span>

    <span class="nd">@img_shape_checker</span>
    <span class="k">def</span> <span class="nf">_apply_img</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">LUT</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s1">&#39;LUT&#39;</span><span class="p">])</span></div>


<div class="viewcode-block" id="ImageRandomContrast"><a class="viewcode-back" href="../../../transforms.html#solt.transforms.ImageRandomContrast">[docs]</a><span class="k">class</span> <span class="nc">ImageRandomContrast</span><span class="p">(</span><span class="n">ImageTransform</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Transform randomly changes the contrast</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    p : float</span>
<span class="sd">        Probability of applying this transform,</span>
<span class="sd">    contrast_range : tuple or float or None</span>
<span class="sd">        Gain of the noise. Indicates percentage of indices, which will be changed.</span>
<span class="sd">        If float, then gain_range = (1-contrast_range, 1+contrast_range).</span>
<span class="sd">    data_indices : tuple or None</span>
<span class="sd">        Indices of the images within the data container to which this transform needs to be applied.</span>
<span class="sd">        Every element within the tuple must be integer numbers.</span>
<span class="sd">        If None, then the transform will be applied to all the images withing the DataContainer.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">contrast_range</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">data_indices</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ImageRandomContrast</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">data_indices</span><span class="o">=</span><span class="n">data_indices</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">contrast_range</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">contrast_range</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">contrast_range</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="n">contrast_range</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">contrast_range</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">contrast_range</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_contrast_range</span> <span class="o">=</span> <span class="n">validate_numeric_range_parameter</span><span class="p">(</span><span class="n">contrast_range</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">sample_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">contrast_mul</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_contrast_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_contrast_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">lut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span> <span class="o">*</span> <span class="n">contrast_mul</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">256</span><span class="p">)])</span>
        <span class="n">lut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">lut</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;contrast_mul&#39;</span><span class="p">:</span> <span class="n">contrast_mul</span><span class="p">,</span> <span class="s1">&#39;LUT&#39;</span><span class="p">:</span> <span class="n">lut</span><span class="p">}</span>

    <span class="nd">@img_shape_checker</span>
    <span class="k">def</span> <span class="nf">_apply_img</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">LUT</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s1">&#39;LUT&#39;</span><span class="p">])</span></div>


<div class="viewcode-block" id="ImageBlur"><a class="viewcode-back" href="../../../transforms.html#solt.transforms.ImageBlur">[docs]</a><span class="k">class</span> <span class="nc">ImageBlur</span><span class="p">(</span><span class="n">ImageTransform</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Transform blurs an image</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    p : float</span>
<span class="sd">        Probability of applying this transform,</span>
<span class="sd">    blur_type : str</span>
<span class="sd">        Blur type. Allowed blurs</span>
<span class="sd">    k_size: int or tuple</span>
<span class="sd">        Kernel sizes of the blur. if int, then sampled from (k_size, k_size). If tuple,</span>
<span class="sd">        then sampled from the whole tuple. All the values here must be odd.</span>
<span class="sd">    gaussian_sigma: int or float or tuple</span>
<span class="sd">        Gaussian sigma value. Used for both X and Y axes. If None, then gaussian_sigma=1.</span>
<span class="sd">    data_indices : tuple or None</span>
<span class="sd">        Indices of the images within the data container to which this transform needs to be applied.</span>
<span class="sd">        Every element within the tuple must be integer numbers.</span>
<span class="sd">        If None, then the transform will be applied to all the images withing the DataContainer.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">blur_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">k_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">gaussian_sigma</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_indices</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ImageBlur</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">data_indices</span><span class="o">=</span><span class="n">data_indices</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k_size</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k_size</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">k_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">k_size</span><span class="p">,</span> <span class="n">k_size</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">k_size</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gaussian_sigma</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
            <span class="n">gaussian_sigma</span> <span class="o">=</span> <span class="p">(</span><span class="n">gaussian_sigma</span><span class="p">,</span> <span class="n">gaussian_sigma</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_blur</span> <span class="o">=</span> <span class="n">validate_parameter</span><span class="p">(</span><span class="n">blur_type</span><span class="p">,</span> <span class="n">allowed_blurs</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">basic_type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">heritable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_k_size</span> <span class="o">=</span> <span class="n">k_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gaussian_sigma</span> <span class="o">=</span> <span class="n">validate_numeric_range_parameter</span><span class="p">(</span><span class="n">gaussian_sigma</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">sample_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_k_size</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_gaussian_sigma</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gaussian_sigma</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;k_size&#39;</span><span class="p">:</span> <span class="n">k</span><span class="p">,</span> <span class="s1">&#39;sigma&#39;</span><span class="p">:</span> <span class="n">s</span><span class="p">}</span>

    <span class="nd">@img_shape_checker</span>
    <span class="k">def</span> <span class="nf">_apply_img</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_blur</span> <span class="o">==</span> <span class="s1">&#39;g&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">GaussianBlur</span><span class="p">(</span><span class="n">img</span><span class="p">,</span>
                                    <span class="n">ksize</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s1">&#39;k_size&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s1">&#39;k_size&#39;</span><span class="p">]),</span>
                                    <span class="n">sigmaX</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s1">&#39;sigma&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_blur</span> <span class="o">==</span> <span class="s1">&#39;m&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">medianBlur</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">ksize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s1">&#39;k_size&#39;</span><span class="p">])</span></div>


<div class="viewcode-block" id="ImageRandomHSV"><a class="viewcode-back" href="../../../transforms.html#solt.transforms.ImageRandomHSV">[docs]</a><span class="k">class</span> <span class="nc">ImageRandomHSV</span><span class="p">(</span><span class="n">ImageTransform</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Performs a random HSV color shift.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    p : float</span>
<span class="sd">        Probability of applying this transform,</span>
<span class="sd">    h_range: tuple or None</span>
<span class="sd">        Hue shift range. If None, than h_range=(0, 0).</span>
<span class="sd">    s_range: tuple or None</span>
<span class="sd">        Saturation shift range. If None, then s_range=(0, 0).</span>
<span class="sd">    v_range: tuple or None</span>
<span class="sd">        Value shift range. If None, then v_range=(0, 0).</span>
<span class="sd">    data_indices : tuple or None</span>
<span class="sd">        Indices of the images within the data container to which this transform needs to be applied.</span>
<span class="sd">        Every element within the tuple must be integer numbers.</span>
<span class="sd">        If None, then the transform will be applied to all the images withing the DataContainer.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">h_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">s_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">v_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_indices</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ImageRandomHSV</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">data_indices</span><span class="o">=</span><span class="n">data_indices</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_h_range</span> <span class="o">=</span> <span class="n">validate_numeric_range_parameter</span><span class="p">(</span><span class="n">h_range</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_s_range</span> <span class="o">=</span> <span class="n">validate_numeric_range_parameter</span><span class="p">(</span><span class="n">s_range</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_v_range</span> <span class="o">=</span> <span class="n">validate_numeric_range_parameter</span><span class="p">(</span><span class="n">v_range</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">sample_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_h_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_h_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_s_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_s_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_v_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_v_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;h_mod&#39;</span><span class="p">:</span> <span class="n">h</span><span class="p">,</span> <span class="s1">&#39;s_mod&#39;</span><span class="p">:</span> <span class="n">s</span><span class="p">,</span> <span class="s1">&#39;v_mod&#39;</span><span class="p">:</span> <span class="n">v</span><span class="p">}</span>

    <span class="nd">@img_shape_checker</span>
    <span class="k">def</span> <span class="nf">_apply_img</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">dtype</span>
        <span class="k">if</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>

        <span class="k">if</span> <span class="n">dtype</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span>

        <span class="n">img_hsv</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_RGB2HSV</span><span class="p">)</span>
        <span class="n">h</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">img_hsv</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">))</span>

        <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="nb">abs</span><span class="p">((</span><span class="n">h</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s1">&#39;h_mod&#39;</span><span class="p">])</span> <span class="o">%</span> <span class="mi">180</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">180</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s1">&#39;s_mod&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">v</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s1">&#39;v_mod&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>

        <span class="n">img_hsv_shifted</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">merge</span><span class="p">((</span><span class="n">h</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img_hsv_shifted</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_HSV2RGB</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">img</span></div>


<div class="viewcode-block" id="ImageRandomBrightness"><a class="viewcode-back" href="../../../transforms.html#solt.transforms.ImageRandomBrightness">[docs]</a><span class="k">class</span> <span class="nc">ImageRandomBrightness</span><span class="p">(</span><span class="n">ImageRandomHSV</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Performs a random brightness augmentation</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    p : float</span>
<span class="sd">        Probability of applying this transform,</span>
<span class="sd">    brightness_range: tuple or None</span>
<span class="sd">        brightness_range shift range (0-255). If None, then brightness_range=(0, 0).</span>
<span class="sd">    data_indices : tuple or None</span>
<span class="sd">        Indices of the images within the data container to which this transform needs to be applied.</span>
<span class="sd">        Every element within the tuple must be integer numbers.</span>
<span class="sd">        If None, then the transform will be applied to all the images withing the DataContainer.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">brightness_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_indices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ImageRandomBrightness</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span>
                                                    <span class="n">h_range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                                                    <span class="n">s_range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                                                    <span class="n">v_range</span><span class="o">=</span><span class="n">brightness_range</span><span class="p">,</span>
                                                    <span class="n">data_indices</span><span class="o">=</span><span class="n">data_indices</span>
                                                    <span class="p">)</span>

    <span class="nd">@img_shape_checker</span>
    <span class="k">def</span> <span class="nf">_apply_img</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">gs</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_GRAY2RGB</span><span class="p">)</span>
            <span class="n">gs</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">gs</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">ImageRandomBrightness</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_apply_img</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">settings</span><span class="p">)[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">ImageRandomBrightness</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_apply_img</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">settings</span><span class="p">)</span></div>


<div class="viewcode-block" id="ImageColorTransform"><a class="viewcode-back" href="../../../transforms.html#solt.transforms.ImageColorTransform">[docs]</a><span class="k">class</span> <span class="nc">ImageColorTransform</span><span class="p">(</span><span class="n">ImageTransform</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;RGB to grayscale or grayscale to RGB image conversion.</span>

<span class="sd">    If converting from grayscale to RGB, then the gs channel is simply clonned.</span>
<span class="sd">    If converting from RGB to grayscale, then opencv is used.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    mode : str</span>
<span class="sd">        Color conversion mode. If None, then no conversion happens and mode=none.</span>
<span class="sd">        If `mode == &#39;rgb2gs&#39;` and the image is already grayscale,</span>
<span class="sd">        then nothing happens. If `mode == &#39;gs2rgb&#39;` and the image is already RGB,</span>
<span class="sd">        then also nothing happens.</span>
<span class="sd">    data_indices : tuple or None</span>
<span class="sd">        Indices of the images within the data container to which this transform needs to be applied.</span>
<span class="sd">        Every element within the tuple must be integer numbers.</span>
<span class="sd">        If None, then the transform will be applied to all the images withing the DataContainer.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_indices</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ImageColorTransform</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">data_indices</span><span class="o">=</span><span class="n">data_indices</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="o">=</span> <span class="n">validate_parameter</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">allowed_color_conversions</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">heritable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span>

    <span class="k">def</span> <span class="nf">sample_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@img_shape_checker</span>
    <span class="k">def</span> <span class="nf">_apply_img</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">img</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;gs2rgb&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span>
            <span class="k">if</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="n">img</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">img</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">img</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;rgb2gs&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span>
            <span class="k">if</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">img</span>
            <span class="k">elif</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_RGB2GRAY</span><span class="p">)</span></div>



</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Aleksei Tiulpin, Research Unit of Medical Imaging, Physics and Technology. University of Oulu.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  <script>
    var versions_json_url = ''
</script>

<div class="rst-versions" data-toggle="rst-versions" role="note"
     aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"></span>
        v0.1.3
      <span class="fa fa-caret-down"></span>
    </span>

    <div class="rst-other-versions">
        <dl id="versionselector">
            <dt>Other Versions</dt>
        </dl>

    </div>
</div>

  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'v0.1.3',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script type="text/javascript" src="../../../_static/js/versions.js"></script>

  

  <script type="text/javascript" src="../../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>